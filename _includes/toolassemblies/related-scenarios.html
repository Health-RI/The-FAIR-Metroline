{% comment %}
  related-scenarios.html
  Shows all tool scenarios that use the specified tool_id
  Usage: {% include toolassemblies/related-scenarios.html tool_id="oncoanalyser" %}
{% endcomment %}

{% assign current_tool_id = include.tool_id %}
{% assign related_scenarios = "" | split: "" %}

{% comment %} Loop through all tool-scenarios data files {% endcomment %}
{% for scenario_file in site.data.tool-scenarios %}
  {% assign scenario_id = scenario_file[0] %}
  {% assign scenario_steps = scenario_file[1] %}
  
  {% comment %} Check if any step in this scenario uses the current tool {% endcomment %}
  {% assign tool_found = false %}
  {% for step in scenario_steps %}
    {% if step.tool_ids contains current_tool_id %}
      {% assign tool_found = true %}
      {% break %}
    {% endif %}
  {% endfor %}
  
  {% comment %} If tool found, add this scenario to related scenarios {% endcomment %}
  {% if tool_found %}
    {% assign related_scenarios = related_scenarios | push: scenario_id %}
  {% endif %}
{% endfor %}

{% comment %} Display the related scenarios if any found {% endcomment %}
{% if related_scenarios.size > 0 %}
<div class="related-scenarios mt-5">
  <h2>Used in scenarios</h2>
  <div class="scenario-cards-grid scenario-cards-compact">
    {% for scenario_id in related_scenarios %}
      {% comment %} Find the scenario metadata from scenarios_list.yml {% endcomment %}
      {% assign scenario_meta = site.data.scenarios_list | where_exp: "item", "item.url contains scenario_id" | first %}
      
      {% if scenario_meta %}
      <a href="/{{ scenario_meta.url }}" class="scenario-card">
        {%- if scenario_meta.icon %}
        <div class="scenario-card-icon">{{ scenario_meta.icon }}</div>
        {%- endif %}
        
        <h3 class="scenario-card-title">{{ scenario_meta.title }}</h3>

        {% if scenario_meta.description %}
        <p class="scenario-card-description">{{ scenario_meta.description }}</p>
        {% endif %}

        <div class="scenario-card-meta">
          {% if scenario_meta.type %}
          <span class="scenario-type">{{ scenario_meta.type | replace: "_", " " | capitalize }}</span>
          {% endif %}

          {% if scenario_meta.complexity %}
          <span class="scenario-complexity">{{ scenario_meta.complexity }} complexity</span>
          {% endif %}
        </div>
      </a>
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endif %}
