<!-- Metro Timeline Component -->
<div class="metro-timeline">
  {% for stop in include.stops %}
  
  <!-- Look up the step from metroline_steps.yml if step_id is provided -->
  {% assign metroline_step = nil %}
  {% if stop.step_id %}
    {% for step in site.data.metroline_steps %}
      {% if step.id == stop.step_id %}
        {% assign metroline_step = step %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}
  
  <!-- Use metroline step data if available, otherwise use stop data directly -->
  {% assign display_title = stop.title | default: metroline_step.title %}
  {% assign display_icon = stop.icon | default: metroline_step.icon %}
  {% assign display_link = stop.link %}
  {% unless display_link %}
    {% if metroline_step.url %}
      {% assign display_link = metroline_step.url | prepend: "/" %}
    {% endif %}
  {% endunless %}
  
  <div class="metro-stop {{ stop.status }}" data-stop-id="{{ forloop.index }}">
    
    <!-- Stop header with marker and title -->
    <div class="metro-stop-header">
      <div class="metro-marker">
        <div class="metro-dot"></div>
        {% if forloop.last == false %}
        <div class="metro-line"></div>
        {% endif %}
      </div>
      
      <div class="metro-content">
        <h3 class="metro-title">
          {% if display_icon %}{{ display_icon }} {% endif %}{{ display_title }}
        </h3>
        {% if stop.short_description or stop.description or stop.examples or stop.link %}
        <button class="metro-toggle" aria-expanded="false">
          <span class="toggle-icon">â–¼</span>
        </button>
        {% endif %}
      </div>
    </div>
    
    <!-- Stop details (expandable) -->
    {% if stop.short_description or stop.description or stop.examples or stop.link %}
    <div class="metro-details" style="display: none;">
      <div class="metro-description">
        
        {% if stop.short_description %}
        <p class="short-description">{{ stop.short_description }}</p>
        {% endif %}
        
        {% if stop.description %}
        <div class="full-description">{{ stop.description }}</div>
        {% endif %}
        
        {% if stop.examples %}
        <div class="metro-examples">
          <h4>Examples</h4>
          <div class="example-tabs">
            {% for example in stop.examples %}
            <button class="example-tab {% if forloop.first %}active{% endif %}" data-example="{{ forloop.index }}">
              {{ example.role }}
            </button>
            {% endfor %}
          </div>
          <div class="example-content">
            {% for example in stop.examples %}
            <div class="example-panel {% if forloop.first %}active{% endif %}" data-example="{{ forloop.index }}">
              <h5>{{ example.role }}</h5>
              <p>{{ example.description }}</p>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        
        {% if display_link %}
        <div class="metro-link">
          <a href="{{ display_link }}" class="btn-link">
            ðŸ“„ View full step details
          </a>
        </div>
        {% endif %}
        
      </div>
    </div>
    {% endif %}
    
  </div>
  {% endfor %}
</div>

<script src="/assets/js/metro-timeline.js"></script>